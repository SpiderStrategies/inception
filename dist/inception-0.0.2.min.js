/*!
 * inception.js v0.0.2 
 * Copyright 2012, Spider Strategies <nathan.bowser@spiderstrategies.com> 
 * inception.js may be freely distributed under the BSD license. 
*/
(function(e){"use strict";var t=function(e){this.container=e.container;if(!e.container)throw new Error("Inception needs a container");e=$.extend({},{topOffset:50,scale:.02,hiddenOverallHeight:400,labelField:"name",linkPop:!1,animate:!0},e),this.stack=$("<ul>").addClass("inception-stack"),$(this.container).append(this.stack),this.steps=[],this.opts=e};t.prototype._resize=function(){if(this.length()===1)return;var e=this.top(),t=this,n=0,r=this.opts.hiddenOverallHeight;$.each(Array.prototype.slice.call(this.steps,0,this.steps.indexOf(e)),function(e,i){i.$el.removeClass("inception-step-top");var s=1-t.opts.scale*(t.steps.length-i.index-1),o=-1*((r-r*s)/2)*(1/s),u="scale("+s+","+s+") translate(0, "+o+"px)";i.$el.height(r).css({"-webkit-transform":u,"-moz-transform":u,"-ms-transform":u,"-o-transform":u,transform:u,"margin-top":n+"px",overflow:"hidden"}),n+=t.opts.topOffset*s}),e.$el.css("margin-top",n+"px"),this.bottom().$el.height(r)},t.prototype.top=function(){return this.steps[this.steps.length-1]},t.prototype.bottom=function(){return this.steps[0]},t.prototype.push=function(e,t){var r=this.top(),i=new n(e[this.opts.labelField],e,this.steps.length,this.opts.topOffset);r&&(r.drop(),i.$el.addClass("inception-step-top"));var s=this;$(i).on("remove",function(){s._retreat(this)}),this.stack.append(i.render().$el),this.steps.push(i),this._resize()},t.prototype._retreat=function(e){var t=this;$.each(Array.prototype.slice.call(this.steps,this.steps.indexOf(e)+1),function(){t.pop()})},t.prototype.pop=function(){this.steps.pop().remove(),this.top().rise(),this._resize()},t.prototype.length=function(){return this.steps.length};var n=function(e,t,n,i){this.view=t,this.index=n,this.offset=i,this.cover=(new r(e)).render();var s=this;this.cover.$el.on("click",function(){$(s).triggerHandler("remove",s)}),this.$el=$("<li>").addClass("inception-step")};n.prototype.render=function(){return this.index===0&&this.$el.addClass("inception-step-bottom"),this.$el.append(this.view.render().el),this},n.prototype.drop=function(){return this.cover.$el.show(),this.$el.append(this.cover.$el),this},n.prototype.rise=function(){return this.$el.css({height:"","-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":"",transform:""}),this.cover.remove(),this},n.prototype.remove=function(){return this.cover.remove(),this.cover.$el.unbind("click",this.close),this.cover=null,this.$el.remove(),this};var r=function(e){this.label=e,this.$el=$("<div>").addClass("inception-step-cover")};r.prototype.render=function(){return this.$el.html('<header><a href="#">'+this.label+"</a></header>"),this},r.prototype.remove=function(){this.label=null,this.$el.hide()},e.Inception=t})(window);