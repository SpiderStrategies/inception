/*!
 * inception.js v0.0.4 
 * Copyright 2012, Spider Strategies <nathan.bowser@spiderstrategies.com> 
 * inception.js may be freely distributed under the BSD license. 
*/
(function(e){"use strict";var t=function(){};t.prototype.init=function(){this.jq=$(this)},t.prototype.emit=t.prototype.trigger=function(e,t){!this.jq&&this.init(),this.jq.trigger(e,t)},t.prototype.once=function(e,t){!this.jq&&this.init(),this.jq.one(e,t)},t.prototype.on=function(e,t){!this.jq&&this.init(),this.jq.bind(e,t)},t.prototype.off=function(e,t){!this.jq&&this.init(),this.jq.unbind(e,t)};var n=function(e){this.container=e.container;if(!e.container)throw new Error("Inception needs a container");e=$.extend({},{topOffset:50,scale:.02,hiddenOverallHeight:400},e),this.stack=$("<ul>").addClass("inception-stack"),$(this.container).append(this.stack),this.steps=[],this.opts=e};n.prototype._resize=function(){if(this.length()===0)return;var e=this.top(),t=this,n=this.opts.topOffset;$.each(Array.prototype.slice.call(this.steps,0,this.steps.indexOf(e)),function(e,s){var o=1-t.opts.scale*(t.steps.length-s.index-1),u=t.opts.hiddenOverallHeight-r(s),a=-1*((u-u*o)/2)*(1/o),f="scale("+o+","+o+") translate(0, "+a+"px)",l=0;s.index>0&&(l=i(s,o,n,u)),s.$el.height(u).css({"-webkit-transform":f,"-moz-transform":f,"-ms-transform":f,"-o-transform":f,transform:f,"margin-top":l+"px",overflow:"hidden"})});if(this.length()>1){var s=this.opts.hiddenOverallHeight-r(e);e.$el.css("margin-top",i(e,1,n,s)+"px"),this.bottom().$el.height(s)}else this.bottom().$el.css("height","auto")};var r=function(e){return parseInt(e.$el.css("padding-top"),10)+parseInt(e.$el.css("padding-bottom"),10)},i=function(e,t,n,i){var s=r(e);return n*t-(i+s)};n.prototype.top=function(){return this.steps[this.steps.length-1]},n.prototype.bottom=function(){return this.steps[0]},n.prototype.push=function(e,t){var n=this.top(),r=new s(t,e,this.steps.length,this.opts.topOffset);n&&(n.drop(),r.$el.addClass("inception-step-top inception-step-fade-in"));var i=this;return $(r).on("remove",function(){i._retreat(this)}),this.stack.append(r.render().$el),this.steps.push(r),this._resize(),r},n.prototype._retreat=function(e){var t=this;$.each(Array.prototype.slice.call(this.steps,this.steps.indexOf(e)+1),function(){t.pop()})},n.prototype.pop=function(){var e=this.steps.pop();return e.remove(),this.top()&&this.top().rise(),this._resize(),e},n.prototype.length=function(){return this.steps.length};var s=function(e,t,n,r){this.view=t,this.index=n,this.offset=r,this.cover=(new o(e)).render();var i=this;this.cover.$el.on("click",function(){$(i).triggerHandler("remove",i)}),this.$el=$("<li>").addClass("inception-step")};$.extend(s.prototype,new t),s.prototype.render=function(){return this.index===0&&this.$el.addClass("inception-step-bottom"),this.$el.append(this.view),this},s.prototype.drop=function(){return this.$el.removeClass("inception-step-top").addClass("inception-step-covered"),this.cover.$el.show(),this.$el.append(this.cover.$el),this},s.prototype.rise=function(){return this.index&&this.$el.addClass("inception-step-top"),this.$el.css({height:"","-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":"",transform:""}),this.$el.removeClass("inception-step-covered"),this.cover.remove(),this},s.prototype.remove=function(){return this.emit("close"),this.cover.remove(),this.cover.$el.unbind("click",this.close),this.cover=null,this.$el.remove(),this};var o=function(e){this.label=$.isFunction(e)?e.apply(this):e,this.$el=$("<div>").addClass("inception-step-cover")};o.prototype.render=function(){return this.$el.html('<header><a href="#">'+this.label+"</a></header>"),this},o.prototype.remove=function(){this.label=null,this.$el.hide()},e.Inception=n})(window);